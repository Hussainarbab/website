<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialEarn - Earn Through Social Media</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .hero-bg {
            background: linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
    <style>
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-active {
            overflow-x: hidden;
            overflow-y: visible !important;
        }
    </style>
</head>
<body class="font-sans bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                    <span class="text-2xl font-bold text-blue-600">SocialEarn</span>
                    </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#features" class="text-gray-700 hover:text-blue-600">Features</a>
                    <a href="#how-it-works" class="text-gray-700 hover:text-blue-600">How it Works</a>
                    <a href="#rewards" class="text-gray-700 hover:text-blue-600">Rewards</a>
                    <button class="bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700">Sign Up</button>
                    <button class="bg-gray-200 text-gray-700 px-6 py-2 rounded-full hover:bg-gray-300">Login</button>
                    <span id="backend-status" title="Click to change API URL" class="ml-2 text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600 cursor-pointer">Backend: checkingâ€¦</span>
                </div>
                <div class="md:hidden">
                    <button id="menu-btn" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <a href="#features" class="block py-2 px-4 text-sm hover:bg-gray-100">Features</a>
            <a href="#how-it-works" class="block py-2 px-4 text-sm hover:bg-gray-100">How it Works</a>
            <a href="#rewards" class="block py-2 px-4 text-sm hover:bg-gray-100">Rewards</a>
            <div class="p-4 space-y-2">
                <button class="w-full bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700">Sign Up</button>
                <button class="w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-300">Login</button>
            </div>
        </div>
    </nav>

    <div id="landing">
    <!-- Hero Section -->
    <section class="hero-bg text-white pt-32 pb-20">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center">
                <div class="md:w-1/2 mb-8 md:mb-0">
                    <h1 class="text-4xl md:text-5xl font-bold mb-6">
                        Earn Money Through Your Social Media Presence
                    </h1>
                    <p class="text-lg mb-8">
                        Connect your social media accounts, complete simple tasks, and earn real money. Withdraw instantly through EasyPaisa or JazzCash.
                    </p>
                    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                        <button class="bg-white text-blue-600 px-8 py-3 rounded-full hover:bg-gray-100 transition duration-300 font-semibold">
                Get Started
            </button>
                        <button class="bg-blue-700 text-white px-8 py-3 rounded-full hover:bg-blue-800 transition duration-300 font-semibold">
                            Learn More
                        </button>
                    </div>
                </div>
                <div class="md:w-1/2 mt-8 md:mt-0">
                    <img src="./WEB-600-x-400.webp" alt="App Preview" class="rounded-lg shadow-2xl">
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-20 bg-white">
        <div class="max-w-6xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12">Why Choose SocialEarn?</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-lg card-hover">
                    <div class="text-4xl text-blue-600 mb-4">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-4">Daily Rewards</h3>
                    <p class="text-gray-600">Earn 100 PKR daily just by staying logged in for 24 hours. Simple and guaranteed earnings.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg card-hover">
                    <div class="text-4xl text-blue-600 mb-4">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-4">Easy Integration</h3>
                    <p class="text-gray-600">Connect WhatsApp, Facebook, and TikTok with just one click. Secure and hassle-free.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg card-hover">
                    <div class="text-4xl text-blue-600 mb-4">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-4">Instant Withdrawals</h3>
                    <p class="text-gray-600">Withdraw your earnings instantly via EasyPaisa or JazzCash. No minimum withdrawal limit.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section id="how-it-works" class="py-20 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12">How It Works</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="text-center">
                    <div class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold">1</div>
                    <h3 class="text-xl font-semibold mb-2">Sign Up</h3>
                    <p class="text-gray-600">Create your account in minutes with basic information</p>
                </div>
                <div class="text-center">
                    <div class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold">2</div>
                    <h3 class="text-xl font-semibold mb-2">Connect Accounts</h3>
                    <p class="text-gray-600">Link your WhatsApp and social media accounts securely</p>
                </div>
                <div class="text-center">
                    <div class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold">3</div>
                    <h3 class="text-xl font-semibold mb-2">Stay Active</h3>
                    <p class="text-gray-600">Keep your account active and complete simple tasks</p>
                </div>
                <div class="text-center">
                    <div class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold">4</div>
                    <h3 class="text-xl font-semibold mb-2">Get Paid</h3>
                    <p class="text-gray-600">Withdraw your earnings to EasyPaisa or JazzCash</p>
                </div>
            </div>
        </div>
    </section>
    </div>

    <!-- Rewards Section -->
    <section id="rewards" class="py-20 bg-white">
        <div class="max-w-6xl mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12">Earning Opportunities</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-gray-50 p-8 rounded-lg shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="text-3xl text-blue-600 mr-4">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3 class="text-2xl font-semibold">Daily Login Rewards</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Earn 100 PKR every day just by keeping your account active for 24 hours.</p>
                    <ul class="space-y-2 text-gray-600">
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            No complex tasks required
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            Automatic tracking system
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            Daily guaranteed earnings
                        </li>
                    </ul>
                </div>
                <div class="bg-gray-50 p-8 rounded-lg shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="text-3xl text-blue-600 mr-4">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <h3 class="text-2xl font-semibold">Bonus Tasks</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Complete additional tasks to earn extra rewards through your social media accounts.</p>
                    <ul class="space-y-2 text-gray-600">
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            Social media engagement tasks
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            WhatsApp activity monitoring
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-2"></i>
                            Bonus rewards for consistent activity
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Sign Up Modal -->
    <div id="signup-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <!-- Title -->
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-blue-600">Sign Up</p>
                    <div class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-gray-500" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                    </svg>
                </div>
                </div>

                <!-- Form -->
                <form id="signup-form" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="signup-name">Full Name</label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="signup-name" type="text" placeholder="Enter your full name" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="signup-email">Email</label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="signup-email" type="email" placeholder="Enter your email" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="signup-password">Password</label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="signup-password" type="password" placeholder="Create a password" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="signup-confirm-password">Confirm Password</label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="signup-confirm-password" type="password" placeholder="Confirm your password" required>
                    </div>
                    <div id="signup-error" class="text-red-500 text-sm hidden"></div>
                    <div class="flex justify-end pt-2">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 mr-2">Sign Up</button>
                        <button type="button" class="modal-close bg-gray-300 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-400">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
            </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <!-- Title -->
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-blue-600">Login</p>
                    <div class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-gray-500" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                    </svg>
                </div>
                </div>

                <!-- Form -->
                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="login-email">Email</label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="login-email" type="email" placeholder="Enter your email" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="login-password">Password</label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="login-password" type="password" placeholder="Enter your password" required>
                    </div>
                    <div id="login-error" class="text-red-500 text-sm hidden"></div>
                    <div class="flex justify-end pt-2">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 mr-2">Login</button>
                        <button type="button" class="modal-close bg-gray-300 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-400">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
            </div>

    <!-- Dashboard Section (shown after login) -->
    <section id="dashboard" class="pt-24 pb-12 bg-gray-50 hidden">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                <!-- Sidebar -->
                <aside class="lg:col-span-1 bg-white rounded-xl shadow-md p-4 h-fit">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold" id="user-initial">U</div>
                        <div>
                            <div class="font-semibold" id="user-name">User</div>
                            <div class="text-xs text-gray-500" id="user-email">user@email.com</div>
                        </div>
                    </div>
                    <nav class="space-y-2" id="sidebar-tabs">
                        <button id="tab-overview" data-tab="overview" class="w-full text-left px-3 py-2 rounded-md bg-blue-50 text-blue-700 font-medium">Overview</button>
                        <button id="tab-tasks" data-tab="tasks" class="w-full text-left px-3 py-2 rounded-md hover:bg-gray-50">Tasks</button>
                        <button id="tab-connections" data-tab="connections" class="w-full text-left px-3 py-2 rounded-md hover:bg-gray-50">Connections</button>
                        <button id="tab-wallet" data-tab="wallet" class="w-full text-left px-3 py-2 rounded-md hover:bg-gray-50">Wallet</button>
                    </nav>
                    <hr class="my-4">
                    <button id="logout-btn" class="w-full px-3 py-2 rounded-md bg-gray-100 hover:bg-gray-200">Logout</button>
                </aside>

                <!-- Main -->
                <main class="lg:col-span-4 space-y-6">
                    <!-- Overview Panel -->
                    <section id="panel-overview">
                        <div class="bg-white rounded-xl shadow-md p-4 flex items-center justify-between">
                            <div>
                                <h2 class="text-2xl font-bold">Dashboard</h2>
                                <p class="text-sm text-gray-500">Welcome back, <span id="welcome-name">User</span></p>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-500">Balance</span>
                                <span class="text-lg font-semibold text-blue-700" id="dashboard-earnings">0</span>
                                <span class="text-sm">PKR</span>
                            </div>
                        </div>
                        <div class="grid sm:grid-cols-2 xl:grid-cols-4 gap-4 mt-4">
                            <div class="bg-white rounded-xl shadow p-5">
                                <div class="text-gray-500 text-sm">Daily Reward</div>
                                <div class="text-2xl font-bold">100 <span class="text-base font-medium">PKR</span></div>
                                <div class="text-xs text-gray-400">Earn by staying active 24h</div>
                            </div>
                            <div class="bg-white rounded-xl shadow p-5">
                                <div class="text-gray-500 text-sm">Points</div>
                                <div id="dashboard-points" class="text-2xl font-bold">0</div>
                                <div class="text-xs text-gray-400">From tasks and activity</div>
                            </div>
                            <div class="bg-white rounded-xl shadow p-5">
                                <div class="text-gray-500 text-sm">Rupees from Points</div>
                                <div id="dashboard-rupees" class="text-2xl font-bold">0</div>
                                <div class="text-xs text-gray-400">Auto-converted</div>
                            </div>
                            <div class="bg-white rounded-xl shadow p-5">
                                <div class="text-gray-500 text-sm">Connected</div>
                                <div id="connected-count" class="text-2xl font-bold">0</div>
                                <div class="text-xs text-gray-400">Accounts linked</div>
                            </div>
                        </div>
                    </section>

                    <!-- Tasks Panel -->
                    <section id="panel-tasks" class="hidden">
                        <div class="bg-white rounded-xl shadow p-5">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold">Todayâ€™s Tasks</h3>
                                <button class="text-sm text-blue-600">View all</button>
                            </div>
                            <ul class="space-y-3" id="tasks-list">
                                <li class="p-3 border rounded-md flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Connect WhatsApp Business</div>
                                        <div class="text-xs text-gray-500">Start session via official API</div>
                                    </div>
                                    <button id="connect-whatsapp" class="px-3 py-1.5 rounded bg-green-600 text-white">Connect</button>
                                </li>
                                <li class="p-3 border rounded-md flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Link TikTok account</div>
                                        <div class="text-xs text-gray-500">Authorize via OAuth</div>
                                    </div>
                                    <button id="connect-tiktok" class="px-3 py-1.5 rounded bg-pink-600 text-white">Connect</button>
                                </li>
                                <li class="p-3 border rounded-md flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Link Facebook account</div>
                                        <div class="text-xs text-gray-500">Use Facebook Login</div>
                                    </div>
                                    <button id="connect-facebook" class="px-3 py-1.5 rounded bg-blue-600 text-white">Connect</button>
                                </li>
                            </ul>
                        </div>
                    </section>

                    <!-- Connections Panel -->
                    <section id="panel-connections" class="hidden">
                        <div class="bg-white rounded-xl shadow p-5">
                            <h3 class="font-semibold mb-4">Connected Accounts</h3>
                            <div id="connections-list" class="space-y-3 text-sm text-gray-700">No accounts linked yet.</div>
                        </div>
                    </section>

                    <!-- Wallet Panel -->
                    <section id="panel-wallet" class="hidden">
                        <div class="bg-white rounded-xl shadow p-5">
                            <h3 class="font-semibold mb-3">Wallet</h3>
                            <div class="p-4 bg-gray-50 rounded-md mb-3">
                                <div class="text-sm text-gray-500">Current Balance</div>
                                <div class="text-2xl font-bold"><span id="wallet-balance">0</span> PKR</div>
                            </div>
                            <div class="grid sm:grid-cols-2 gap-2">
                                <button id="withdraw-easypaisa" class="w-full py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Withdraw to Easypaisa</button>
                                <button id="withdraw-jazzcash" class="w-full py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700">Withdraw to JazzCash</button>
                            </div>
                </div>
                    </section>
                </main>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">SocialEarn</h3>
                    <p class="text-gray-400">Earn money through your social media presence</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Home</a></li>
                        <li><a href="#features" class="text-gray-400 hover:text-white">Features</a></li>
                        <li><a href="#how-it-works" class="text-gray-400 hover:text-white">How it Works</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Legal</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Terms of Service</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Contact</h4>
                    <p class="text-gray-400">Email: hussyn763@gmail.com</p>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                <p class="text-gray-400">&copy; 2025 SocialEarn. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Withdraw Modal -->
    <div id="withdraw-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-blue-600">Withdraw</p>
                    <button id="withdraw-close" class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-gray-500" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </button>
                </div>
                <form id="withdraw-form" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Provider</label>
                        <input id="w-provider" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 bg-gray-100" type="text" readonly>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="w-name">Full Name</label>
                        <input id="w-name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" type="text" placeholder="Enter account holder name" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="w-number">Mobile Number</label>
                        <input id="w-number" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" type="tel" placeholder="03XXXXXXXXX" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="w-points">Points to Withdraw</label>
                        <input id="w-points" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" type="number" min="100" step="100" placeholder="e.g. 100, 200" required>
                        <p class="text-xs text-gray-500 mt-1">Conversion: 100 points = 10 PKR</p>
                    </div>
                    <div id="withdraw-error" class="text-red-500 text-sm hidden"></div>
                    <div class="flex justify-end pt-2">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 mr-2">Confirm Withdraw</button>
                        <button type="button" id="withdraw-cancel" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-400">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- WhatsApp Connect Modal -->
    <div id="wa-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-lg mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-green-600">Connect WhatsApp</p>
                    <button id="wa-close" class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-gray-500" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </button>
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="border rounded p-3 flex items-center justify-center">
                        <canvas id="wa-qr" class="w-full h-full max-w-[260px] max-h-[260px]"></canvas>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-1">Pairing Code</label>
                        <div class="flex gap-2 items-center">
                            <input id="wa-code" readonly class="flex-1 border rounded px-3 py-2 bg-gray-50" />
                            <button id="wa-copy" class="px-3 py-2 border rounded hover:bg-gray-50">Copy</button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Scan the QR or paste the code into your official WhatsApp Business pairing flow. Code expires in <span id="wa-expire">60</span>s.</p>
                        <button id="wa-refresh" class="mt-3 px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">Refresh Code</button>
                        <div class="mt-4">
                            <label class="block text-gray-700 text-sm font-bold mb-1">Your WhatsApp Number</label>
                            <input id="wa-number" class="w-full border rounded px-3 py-2" type="tel" placeholder="03XXXXXXXXX" />
                            <button id="wa-request-link" class="mt-2 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Request Link</button>
                            <div id="wa-status" class="text-xs text-gray-600 mt-1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Mobile menu toggle
        document.getElementById('menu-btn').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    const offset = 80; // Accounting for fixed header
                    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - offset;
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                    // Close mobile menu if open
                    document.getElementById('mobile-menu').classList.add('hidden');
                }
            });
        });

        // Modal functionality
        const modals = {
            signup: document.getElementById('signup-modal'),
            login: document.getElementById('login-modal')
        };

        // Open modal function
        function openModal(modalType) {
            modals[modalType].classList.remove('opacity-0', 'pointer-events-none');
            document.body.classList.add('modal-active');
        }

        // Close modal function
        function closeModal(modalType) {
            modals[modalType].classList.add('opacity-0', 'pointer-events-none');
            document.body.classList.remove('modal-active');
        }

        // Add click events to all modal close buttons
        document.querySelectorAll('.modal-close').forEach(button => {
            button.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal.id === 'signup-modal') {
                    closeModal('signup');
                } else {
                    closeModal('login');
                }
            });
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            Object.keys(modals).forEach(modalType => {
                if (e.target === modals[modalType]) {
                    closeModal(modalType);
                }
            });
        });

        // Add click events to signup and login buttons
        document.querySelectorAll('button').forEach(button => {
            if (button.textContent.trim() === 'Sign Up') {
                button.addEventListener('click', () => openModal('signup'));
            } else if (button.textContent.trim() === 'Login') {
                button.addEventListener('click', () => openModal('login'));
            }
        });

        // API URL (configurable)
        function getApiUrl() {
            return localStorage.getItem('api:url') || 'http://localhost:5000/api';
        }
        function setApiUrl(url) {
            if (url && url.trim()) localStorage.setItem('api:url', url.trim());
        }
        let API_URL = getApiUrl();

        // Form validation and submission
        document.getElementById('signup-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            const errorDiv = document.getElementById('signup-error');

            // Reset error message
            errorDiv.classList.add('hidden');

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorDiv.textContent = 'Please enter a valid email address';
                errorDiv.classList.remove('hidden');
                return;
            }

            // Validate password length
            if (password.length < 6) {
                errorDiv.textContent = 'Password must be at least 6 characters long';
                errorDiv.classList.remove('hidden');
                return;
            }

            // Check if passwords match
            if (password !== confirmPassword) {
                errorDiv.textContent = 'Passwords do not match';
                errorDiv.classList.remove('hidden');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        email,
                        password
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Error during registration');
                }

                alert(data.message);
                closeModal('signup');
                this.reset();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');

            // Reset error message
            errorDiv.classList.add('hidden');

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Error during login');
                }

                // Store token and user data
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));

                closeModal('login');
                this.reset();
                enterDashboard();
                showDashboard();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        // Add password recovery functionality
        function showForgotPasswordForm() {
            const loginForm = document.querySelector('#login-form');
            const currentContent = loginForm.innerHTML;
            
            loginForm.innerHTML = `
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="recovery-email">Email</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="recovery-email" type="email" placeholder="Enter your email" required>
                </div>
                <div id="recovery-error" class="text-red-500 text-sm hidden"></div>
                <div class="flex justify-end pt-2">
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 mr-2">Send Recovery Email</button>
                    <button type="button" onclick="restoreLoginForm()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-400">Back to Login</button>
                </div>
            `;

            loginForm.onsubmit = async function(e) {
                e.preventDefault();
                const email = document.getElementById('recovery-email').value;
                const errorDiv = document.getElementById('recovery-error');

                try {
                    const response = await fetch(`${API_URL}/auth/forgot-password`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Error requesting password reset');
                    }

                    alert(data.message);
                    restoreLoginForm();
                } catch (error) {
                    errorDiv.textContent = error.message;
                    errorDiv.classList.remove('hidden');
                }
            };
        }

        function restoreLoginForm() {
            location.reload();
        }

        // Add "Forgot Password?" link to login form
        const loginFormButtons = document.querySelector('#login-form .flex.justify-end');
        const forgotPasswordLink = document.createElement('button');
        forgotPasswordLink.type = 'button';
        forgotPasswordLink.className = 'text-blue-600 hover:text-blue-800 text-sm mr-auto';
        forgotPasswordLink.textContent = 'Forgot Password?';
        forgotPasswordLink.onclick = showForgotPasswordForm;
        loginFormButtons.insertBefore(forgotPasswordLink, loginFormButtons.firstChild);

        // Safe JSON parser to avoid HTML responses causing errors
        async function parseJsonSafe(res) {
            const ct = res.headers.get('content-type') || '';
            if (!ct.includes('application/json')) {
                const text = await res.text();
                throw new Error(`Unexpected response (${res.status}). ${text.slice(0,120)}`);
            }
            return res.json();
        }

        // Dashboard tabs switching
        const tabButtons = document.querySelectorAll('#sidebar-tabs [data-tab]');
        const panels = {
            overview: document.getElementById('panel-overview'),
            tasks: document.getElementById('panel-tasks'),
            connections: document.getElementById('panel-connections'),
            wallet: document.getElementById('panel-wallet')
        };
        function switchTab(tab) {
            Object.keys(panels).forEach(key => {
                if (panels[key]) {
                    if (key === tab) panels[key].classList.remove('hidden'); else panels[key].classList.add('hidden');
                }
            });
            tabButtons.forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.classList.add('bg-blue-50','text-blue-700','font-medium');
                } else {
                    btn.classList.remove('bg-blue-50','text-blue-700','font-medium');
                }
            });
        }
        tabButtons.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.tab)));
        // Default tab
        switchTab('overview');

        // Landing/Dashboard toggling
        function enterDashboard() {
            const landing = document.getElementById('landing');
            if (landing) landing.classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
        }
        function showLanding() {
            document.getElementById('dashboard').classList.add('hidden');
            const landing = document.getElementById('landing');
            if (landing) landing.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show dashboard after login if token exists
        function showDashboard() {
            const token = localStorage.getItem('token');
            if (!token) return;
            fetch(`${API_URL}/user/dashboard`, {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(res => res.ok ? parseJsonSafe(res) : Promise.reject(new Error('Failed to load dashboard')))
            .then(data => {
                if (data && (data.email || data.name)) {
                    renderDashboard(data);
                } else {
                    const fallbackUser = JSON.parse(localStorage.getItem('user') || '{}');
                    if (fallbackUser && (fallbackUser.email || fallbackUser.name)) {
                        renderDashboard({
                            name: fallbackUser.name || 'hussain',
                            email: fallbackUser.email || 'arbabhussan62@gmail.com',
                            earnings: fallbackUser.earnings || 0,
                            points: fallbackUser.points || 0,
                            rupeesFromPoints: fallbackUser.rupeesFromPoints || 0,
                            connectedAccounts: fallbackUser.connectedAccounts || []
                        });
                    }
                }
            })
            .catch(() => {
                const fallbackUser = JSON.parse(localStorage.getItem('user') || '{}');
                if (fallbackUser && (fallbackUser.email || fallbackUser.name)) {
                    renderDashboard({
                        name: fallbackUser.name || 'hussain',
                        email: fallbackUser.email || 'arbabhussan62@gmail.com',
                        earnings: fallbackUser.earnings || 0,
                        points: fallbackUser.points || 0,
                        rupeesFromPoints: fallbackUser.rupeesFromPoints || 0,
                        connectedAccounts: fallbackUser.connectedAccounts || []
                    });
                }
            });
        }

        function renderDashboard(data) {
            enterDashboard();
            window.scrollTo({ top: document.getElementById('dashboard').offsetTop - 80, behavior: 'smooth' });

            // Header user details
            document.getElementById('user-name').textContent = data.name || 'User';
            document.getElementById('welcome-name').textContent = data.name || 'User';
            document.getElementById('user-email').textContent = data.email || '';
            document.getElementById('user-initial').textContent = (data.name || 'U').charAt(0).toUpperCase();

            document.getElementById('dashboard-points').textContent = data.points || 0;
            document.getElementById('dashboard-rupees').textContent = data.rupeesFromPoints || 0;
            const earnings = data.earnings || 0;
            document.getElementById('dashboard-earnings').textContent = earnings;
            document.getElementById('wallet-balance').textContent = earnings;
            document.getElementById('connected-count').textContent = (data.connectedAccounts || []).length;

            // Wire up connect buttons
            document.getElementById('connect-whatsapp').onclick = () => openWA();
            document.getElementById('connect-tiktok').onclick = () => connectProvider('tiktok');
            document.getElementById('connect-facebook').onclick = () => connectProvider('facebook');

            document.getElementById('logout-btn').onclick = logout;

            // Populate connections list
            const list = document.getElementById('connections-list');
            const accounts = data.connectedAccounts || [];
            if (list) {
                if (accounts.length === 0) {
                    list.textContent = 'No accounts linked yet.';
                } else {
                    list.innerHTML = '';
                    accounts.forEach(acc => {
                        const item = document.createElement('div');
                        item.className = 'p-3 border rounded-md flex items-center justify-between';
                        item.innerHTML = `<span class=\"capitalize\">${acc}</span><span class=\"text-green-600 text-xs\">Connected</span>`;
                        list.appendChild(item);
                    });
                }
            }

            // Withdraw handlers (100 points => 10 PKR)
            const easypaisaBtn = document.getElementById('withdraw-easypaisa');
            const jazzcashBtn = document.getElementById('withdraw-jazzcash');
            function doWithdraw(provider) {
                const pointsEl = document.getElementById('dashboard-points');
                const earningsEl = document.getElementById('dashboard-earnings');
                const walletEl = document.getElementById('wallet-balance');
                let points = parseInt(pointsEl.textContent || '0', 10) || 0;
                let earnings = parseInt(earningsEl.textContent || '0', 10) || 0;
                const chunks = Math.floor(points / 100);
                if (chunks <= 0) {
                    alert('Not enough points. You need at least 100 points to withdraw.');
                    return;
                }
                const rupees = chunks * 10; // 100 pts -> 10 PKR
                points -= chunks * 100;
                earnings += rupees;
                // Update UI
                pointsEl.textContent = String(points);
                earningsEl.textContent = String(earnings);
                walletEl.textContent = String(earnings);
                document.getElementById('dashboard-rupees').textContent = String(Math.floor(points / 100) * 10);
                // Persist to localStorage user
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                user.points = points;
                user.earnings = earnings;
                user.rupeesFromPoints = Math.floor(points / 100) * 10;
                localStorage.setItem('user', JSON.stringify(user));
                alert(`Withdrew ${rupees} PKR to ${provider}. (${chunks * 100} points converted)`);
                // Optional backend notify (non-blocking)
                const token = localStorage.getItem('token');
                if (token) {
                    fetch(`${API_URL}/user/withdraw`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + token
                        },
                        body: JSON.stringify({ provider, rupees })
                    }).catch(() => {});
                }
            }
            // Wire buttons to open modal
            easypaisaBtn && (easypaisaBtn.onclick = () => openWithdraw('Easypaisa'));
            jazzcashBtn && (jazzcashBtn.onclick = () => openWithdraw('JazzCash'));
        }

        // Withdraw modal logic
        const withdrawModal = document.getElementById('withdraw-modal');
        function openWithdraw(provider) {
            // Prefill provider and sensible defaults
            document.getElementById('w-provider').value = provider;
            const local = JSON.parse(localStorage.getItem('user') || '{}');
            document.getElementById('w-name').value = local.name || '';
            document.getElementById('w-number').value = local.number || '';
            document.getElementById('w-points').value = '';
            document.getElementById('withdraw-error').classList.add('hidden');
            withdrawModal.classList.remove('opacity-0','pointer-events-none');
            document.body.classList.add('modal-active');
        }
        function closeWithdraw() {
            withdrawModal.classList.add('opacity-0','pointer-events-none');
            document.body.classList.remove('modal-active');
        }
        document.getElementById('withdraw-close').onclick = closeWithdraw;
        document.getElementById('withdraw-cancel').onclick = closeWithdraw;
        withdrawModal.addEventListener('click', (e) => { if (e.target === withdrawModal) closeWithdraw(); });

        document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const provider = document.getElementById('w-provider').value;
            const fullName = document.getElementById('w-name').value.trim();
            const number = document.getElementById('w-number').value.trim();
            let pointsToWithdraw = parseInt(document.getElementById('w-points').value, 10) || 0;
            const err = document.getElementById('withdraw-error');
            err.classList.add('hidden');
            
            // Basic validation
            if (!fullName || !number) {
                err.textContent = 'Please enter your name and mobile number.';
                err.classList.remove('hidden');
                return;
            }
            const pointsEl = document.getElementById('dashboard-points');
            const currentPoints = parseInt(pointsEl.textContent || '0', 10) || 0;
            if (pointsToWithdraw < 100 || pointsToWithdraw % 100 !== 0) {
                err.textContent = 'Points must be at least 100 and in multiples of 100.';
                err.classList.remove('hidden');
                return;
            }
            if (pointsToWithdraw > currentPoints) {
                err.textContent = 'You do not have enough points.';
                err.classList.remove('hidden');
                return;
            }

            // Convert and apply
            const rupees = (pointsToWithdraw / 100) * 10;
            // Reuse doWithdraw internals by setting exact points chunk
            // Update UI and localStorage
            const earningsEl = document.getElementById('dashboard-earnings');
            const walletEl = document.getElementById('wallet-balance');
            let points = currentPoints - pointsToWithdraw;
            let earnings = (parseInt(earningsEl.textContent || '0', 10) || 0) + rupees;
            pointsEl.textContent = String(points);
            earningsEl.textContent = String(earnings);
            walletEl.textContent = String(earnings);
            document.getElementById('dashboard-rupees').textContent = String(Math.floor(points / 100) * 10);
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            user.points = points;
            user.earnings = earnings;
            user.rupeesFromPoints = Math.floor(points / 100) * 10;
            user.number = number;
            localStorage.setItem('user', JSON.stringify(user));

            // Optional backend call
            const token = localStorage.getItem('token');
            if (token) {
                fetch(`${API_URL}/user/withdraw`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ provider, rupees, points: pointsToWithdraw, name: fullName, number })
                }).catch(() => {});
            }

            alert(`Withdrawal requested: ${pointsToWithdraw} points -> ${rupees} PKR to ${provider}.`);
            closeWithdraw();
        });

        // WhatsApp modal + code fetch
        const waModal = document.getElementById('wa-modal');
        let waTimer = null;
        function drawCodeAsQRLike(canvas, code) {
            const ctx = canvas.getContext('2d');
            const size = Math.min(260, canvas.parentElement.clientWidth - 16);
            canvas.width = size; canvas.height = size;
            ctx.fillStyle = '#fff'; ctx.fillRect(0,0,size,size);
            const cells = 21;
            const cell = size / cells;
            // simple hash pattern (placeholder, not real QR)
            let h = 0;
            for (let i=0;i<code.length;i++) h = (h*31 + code.charCodeAt(i))>>>0;
            for (let y=0;y<cells;y++) {
                for (let x=0;x<cells;x++) {
                    const v = (x*y + x + y + h) % 7;
                    if (v===0) {
                        ctx.fillStyle = '#111';
                        ctx.fillRect(Math.floor(x*cell), Math.floor(y*cell), Math.ceil(cell-1), Math.ceil(cell-1));
                    }
                }
            }
            // finder squares
            ctx.fillStyle = '#16a34a';
            const f = Math.floor(cell*4.5);
            ctx.fillRect(0,0,f,f);
            ctx.fillRect(size-f,0,f,f);
            ctx.fillRect(0,size-f,f,f);
        }
        function openWA() {
            const token = localStorage.getItem('token');
            if (!token) { alert('Please log in first.'); return; }
            fetch(`${API_URL}/whatsapp/start`, { method:'POST', headers:{ 'Authorization':'Bearer '+token } })
                .then(r => r.ok ? parseJsonSafe(r) : Promise.reject(new Error('Failed to start pairing')))
                .then(d => {
                    const code = d.code || Math.random().toString(36).slice(2,8).toUpperCase();
                    document.getElementById('wa-code').value = code;
                    drawCodeAsQRLike(document.getElementById('wa-qr'), code);
                    let left = d.expiresInSeconds || 60;
                    document.getElementById('wa-expire').textContent = String(left);
                    if (waTimer) clearInterval(waTimer);
                    waTimer = setInterval(()=>{
                        left--; if (left<=0) { clearInterval(waTimer); } 
                        document.getElementById('wa-expire').textContent = String(Math.max(left,0));
                    },1000);
                    waModal.classList.remove('opacity-0','pointer-events-none');
                    document.body.classList.add('modal-active');
                })
                .catch(()=>{
                    // fallback open with random code
                    const code = Math.random().toString(36).slice(2,8).toUpperCase();
                    document.getElementById('wa-code').value = code;
                    drawCodeAsQRLike(document.getElementById('wa-qr'), code);
                    waModal.classList.remove('opacity-0','pointer-events-none');
                    document.body.classList.add('modal-active');
                });
        }
        function closeWA() {
            waModal.classList.add('opacity-0','pointer-events-none');
            document.body.classList.remove('modal-active');
            if (waTimer) clearInterval(waTimer);
        }
        document.getElementById('wa-close').onclick = closeWA;
        waModal.addEventListener('click', (e) => { if (e.target === waModal) closeWA(); });
        document.getElementById('wa-copy').onclick = () => {
            const v = document.getElementById('wa-code').value;
            navigator.clipboard?.writeText(v);
        };
        document.getElementById('wa-refresh').onclick = openWA;
        document.getElementById('wa-request-link').onclick = async () => {
            const token = localStorage.getItem('token');
            if (!token) { alert('Please log in first.'); return; }
            const number = (document.getElementById('wa-number').value || '').trim();
            const statusEl = document.getElementById('wa-status');
            statusEl.textContent = '';
            if (!number) { statusEl.textContent = 'Please enter your WhatsApp number.'; return; }
            try {
                const res = await fetch(`${API_URL}/whatsapp/request`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ number })
                });
                if (!res.ok) {
                    const text = await res.text();
                    throw new Error(text || 'Failed to request link');
                }
                await parseJsonSafe(res);
                statusEl.textContent = 'A confirmation message has been sent to your WhatsApp. Please approve.';
            } catch (e) {
                statusEl.textContent = e.message || 'Failed to request link';
            }
        };

        async function connectProvider(provider) {
            const token = localStorage.getItem('token');
            if (!token) { alert('You must be logged in'); return; }

            try {
                const res = await fetch(`${API_URL}/user/connect-account`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ provider })
                });
                if (!res.ok) {
                    const text = await res.text();
                    throw new Error(text || 'Error connecting');
                }
                const data = await parseJsonSafe(res);
                alert(data.message + '. You earned points!');
                // Refresh dashboard
                showDashboard();
            } catch (err) {
                alert(err.message || 'Error connecting account');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            showLanding();
        }

        // If already logged in, show dashboard (don't show landing)
        document.addEventListener('DOMContentLoaded', () => {
            // Backend health checker
            const statusEl = document.getElementById('backend-status');
            async function checkHealth() {
                const url = getApiUrl();
                try {
                    const controller = new AbortController();
                    const t = setTimeout(() => controller.abort(), 4000);
                    const res = await fetch(`${url}/health`, { signal: controller.signal });
                    clearTimeout(t);
                    if (res.ok) {
                        statusEl.textContent = 'Backend: online';
                        statusEl.className = 'ml-2 text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 cursor-pointer';
                    } else {
                        throw new Error('unhealthy');
                    }
                } catch {
                    statusEl.textContent = 'Backend: offline';
                    statusEl.className = 'ml-2 text-xs px-2 py-1 rounded-full bg-red-100 text-red-700 cursor-pointer';
                }
            }
            statusEl?.addEventListener('click', () => {
                const current = getApiUrl();
                const input = prompt('Set API URL (example: http://localhost:5000/api)', current);
                if (input) {
                    setApiUrl(input);
                    API_URL = getApiUrl();
                    checkHealth();
                }
            });
            checkHealth();
            setInterval(checkHealth, 15000);

            if (localStorage.getItem('token')) {
                enterDashboard();
                showDashboard();
            }
        });
    </script>
</body>
</html>
